{"version":3,"sources":["../src/entities/video.ts"],"names":[],"mappings":"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","file":"video.js","sourcesContent":["import { YouTube, VideoUpdateResource, Caption } from '..'\nimport { Thumbnail, ISODuration } from '../types'\nimport { YTComment } from './comment'\nimport { Parser } from '../util'\n\n/**\n * A YouTube video.\n */\nexport class Video {\n  /**\n   * The name of the endpoint used for this entity.\n   */\n  public static endpoint = 'videos'\n\n  /**\n   * The parts to request for this entity.\n   */\n  public static part = 'snippet,contentDetails,statistics,status'\n\n  /**\n   * The fields to request for this entity.\n   */\n  public static fields = 'items(kind,id,contentDetails(duration),statistics(likeCount,dislikeCount,viewCount,commentCount),' +\n    'status(privacyStatus,madeForKids,selfDeclaredMadeForKids),snippet(title,description,thumbnails,tags,publishedAt,channelId,liveBroadcastContent,categoryId))'\n\n  /**\n   * YouTube object that created the video.\n   */\n  public youtube: YouTube\n\n  /**\n   * The raw data of the video.\n   */\n  public data: any\n\n  /**\n   * Whether or not this is a full video object.\n   */\n  public full: boolean\n\n  /**\n   * The ID of the video.\n   */\n  public id: string\n\n  /**\n   * The title of the video.\n   */\n  public title: string\n\n  /**\n   * The description of the video.\n   */\n  public description: string\n\n  /**\n   * The thumbnails of the video.\n   */\n  public thumbnails: {\n    default?: Thumbnail\n    medium?: Thumbnail\n    high?: Thumbnail\n    standard?: Thumbnail\n    maxres?: Thumbnail\n  }\n\n  /**\n   * The tags of the video.\n   */\n  public tags: string[]\n\n  /**\n   * The date the video was published.\n   */\n  public datePublished: Date\n\n  /**\n   * The ID of the channel that uploaded the video.\n   */\n  public channelId: string\n\n  /**\n   * @ignore\n   */\n  public _length: ISODuration\n\n  /**\n   * The minutes of the video.\n   */\n  public minutes: number\n\n  /**\n   * The seconds of the video.\n   */\n  public seconds: number\n\n  /**\n   * The url of the video.\n   */\n  public url: string\n\n  /**\n   * The short url of the video, i.e. https://youtu.be/id\n   */\n  public shortUrl: string\n\n  /**\n   * The number of likes the video has.\n   */\n  public likes: number\n\n  /**\n   * The number of dislikes the video has.\n   */\n  public dislikes: number\n\n  /**\n   * The number of views the video has.\n   */\n  public views: number\n\n  /**\n   * Whether or not this video COULD BE private. True if the video might\n   * be private, as you cannot check if playlist items are private.\n   *\n   * I would recommend that you try and fetch the video and catch an error\n   * if it is from a playlist & marked as private.\n   */\n  public private: boolean\n\n  /**\n   * The video's comments. Only defined when Video#fetchComments is called.\n   */\n  public comments: YTComment[]\n\n  /**\n   * The number of comments on the video.\n   */\n  public commentCount: number\n\n  /**\n   * If this is a ongoing livestream, this is `live`.\n   * If this is an upcoming livestream, this is `upcoming`.\n   * If this is not a livestream, this is `false`.\n   */\n  public liveStatus: 'live' | 'upcoming' | false\n\n  /**\n   * The video category associated with the video.\n   */\n  public category: string\n\n  /**\n   * Properties to do with videos made for children.\n   */\n  public kids: {\n    /**\n     * Whether or not the video was made for children.\n     */\n    madeForKids: boolean\n\n    /**\n     * Whether or not the poster of the video marked it as made for kids.\n     */\n    selfDeclaredMadeForKids: boolean\n  }\n\n  /**\n   * The caption data associated with this video. Only available after running [[Video#fetchCaptions]].\n   */\n  public captions: Caption[]\n\n  constructor (youtube: YouTube, data: any) {\n    this.youtube = youtube\n    this.data = data\n\n    this._init(data)\n  }\n\n  /**\n   * @ignore\n   */\n  private _init (data: any) {\n    if (data.kind === 'youtube#video') {\n      const video = data\n\n      /* istanbul ignore next */\n      if (video.contentDetails) {\n        this._length = Parser.parseIsoDuration(video.contentDetails.duration)\n        this.minutes = (this._length.hours * 60) + this._length.minutes\n        this.seconds = this._length.seconds\n      } else {\n        this.full = false\n      }\n\n      /* istanbul ignore next */\n      if (video.statistics) {\n        this.likes = Number(video.statistics.likeCount)\n        this.dislikes = Number(video.statistics.dislikeCount)\n        this.views = Number(video.statistics.viewCount)\n        this.commentCount = Number(video.statistics.commentCount)\n      } else {\n        this.full = false\n      }\n\n      this.id = video.id\n    } else if (data.kind === 'youtube#playlistItem') {\n      this.full = false\n      this.id = data.snippet.resourceId.videoId\n      this.private = data.snippet.title === 'Private video'\n    } else if (data.kind === 'youtube#searchResult') {\n      this.full = false\n      this.id = data.id.videoId\n    } else {\n      throw new Error(`Invalid video type: ${data.kind}`)\n    }\n\n    /* istanbul ignore next */\n    if (data.snippet) {\n      this.title = data.snippet.title\n      this.description = data.snippet.description\n      this.thumbnails = data.snippet.thumbnails\n      this.tags = data.snippet.tags\n      this.datePublished = new Date(data.snippet.publishedAt)\n      this.channelId = data.snippet.channelId\n      // Impossible to test\n      /* istanbul ignore next */\n      this.liveStatus = data.snippet.liveBroadcastContent !== 'none' ? data.snippet.liveBroadcastContent : false\n      this.category = data.snippet.categoryId\n    } else {\n      this.full = false\n    }\n\n    /* istanbul ignore next */\n    if (data.status) {\n      this.private = data.status.privacyStatus === 'private'\n      this.kids = {\n        madeForKids: data.status.madeForKids,\n        selfDeclaredMadeForKids: data.status.selfDeclaredMadeForKids\n      }\n    } else {\n      this.full = false\n    }\n\n    this.url = `https://youtube.com/watch?v=${this.id}`\n    this.shortUrl = `https://youtu.be/${this.id}`\n\n    return this\n  }\n\n  /**\n   * Posts a comment to the video.\n   * Must be using an access token with correct scopes.\n   * @param text The text of the comment.\n   */\n  /* istanbul ignore next */\n  public async postComment (text: string) {\n    const comment = await this.youtube.oauth.postComment(text, this.channelId, this.id)\n\n    if (this.comments !== undefined) {\n      this.comments.push(comment)\n    } else {\n      this.comments = [ comment ]\n    }\n\n    return comment\n  }\n\n  /**\n   * Fetches this video and reassigns this object to the new video object.\n   * Only useful if `this.full` is false, or if you want updated video info.\n   */\n  public async fetch () {\n    const video = await this.youtube.getVideo(this.id)\n    return Object.assign(this, video)\n  }\n\n  /**\n   * Fetches the video's comments and assigns them to Video#comments.\n   * @param maxResults The maximum amount of comments to fetch\n   */\n  public async fetchComments (maxResults: number = 10) {\n    this.comments = await this.youtube.getVideoComments(this.id, maxResults)\n    return this.comments\n  }\n\n  /**\n   * Gets the user's rating on the video.\n   */\n  /* istanbul ignore next */\n  public async getRating (): Promise<'like' | 'dislike' | 'none' | 'unspecified'> {\n    const response = await this.youtube.oauth.getMyRatings([ this.id ])\n    return response[0].rating\n  }\n\n  /**\n   * Likes the video.\n   * Must be using an access token with correct scopes.\n   */\n  /* istanbul ignore next */\n  public like () {\n    return this.youtube.oauth.rateVideo(this.id, 'like')\n  }\n\n  /**\n   * Dislikes the video.\n   * Must be using an access token with correct scopes.\n   */\n  /* istanbul ignore next */\n  public dislike () {\n    return this.youtube.oauth.rateVideo(this.id, 'dislike')\n  }\n\n  /**\n   * Removes the user's like/dislike on the video.\n   * Must be using an access token with correct scopes.\n   */\n  /* istanbul ignore next */\n  public unrate () {\n    return this.youtube.oauth.rateVideo(this.id, 'none')\n  }\n\n  /**\n   * Reports the video for abuse.\n   * Must be using an access token with correct scopes.\n   * @param reasonId The reason for reporting. (IDs can be found [here](https://developers.google.com/youtube/v3/docs/videoAbuseReportReasons/list))\n   * @param secondaryReasonId An optional second reason for reporting.\n   * @param comments Any additional information.\n   * @param language The language that the reporter speaks.\n   */\n  /* istanbul ignore next */\n  public reportAbuse (reasonId: string, secondaryReasonId?: string, comments?: string, language?: string) {\n    return this.youtube.oauth.reportAbuse(this.id, reasonId, secondaryReasonId, comments, language)\n  }\n\n  /**\n   * Deletes the video.\n   * Must be using an access token with correct scopes.\n   */\n  /* istanbul ignore next */\n  public delete () {\n    return this.youtube.oauth.deleteVideo(this.id)\n  }\n\n  /**\n   * Edits the video.\n   * Must be using an access token with correct scopes.  \n   * **If your request does not specify a value for a property that already has a value,\n   * the property's existing value will be deleted.**\n   * @param video The updated video object.\n   */\n  /* istanbul ignore next */\n  public async update (video: VideoUpdateResource): Promise<Video> {\n    const newVideo = await this.youtube.oauth.updateVideo(video)\n    return Object.assign(this, { ...newVideo, full: true })\n  }\n\n  /**\n   * Sets a new thumbnail for a video.\n   * Must be using an access token with correct scopes.\n   * @param image The image data and type to upload.\n   */\n  /* istanbul ignore next */\n  public async setThumbnail (image: { type: 'jpeg' | 'png'; data: Buffer }): Promise<typeof Video.prototype.thumbnails> {\n    const newThumbnails = await this.youtube.oauth.setThumbnail(this.id, image)\n    return Object.assign(this.thumbnails, newThumbnails)\n  }\n\n  /**\n   * Fetches the captions for the video.\n   * Must be using an access token with correct scopes.\n   */\n  /* istanbul ignore next */\n  public async fetchCaptions (): Promise<Caption[]> {\n    this.captions = await this.youtube.oauth.getCaptions(this.id)\n    return this.captions\n  }\n\n  /**\n   * Uploads a caption track for a video.\n   * Must be using an access token with correct scopes.\n   * @param language The language of the track.\n   * @param name The name of the track.\n   * @param track The caption track to upload.\n   * @param draft Whether or not the track is a draft.\n   */\n  /* istanbul ignore next */\n  public async uploadCaption (language: string, name: string, track: Buffer, draft: boolean = false): Promise<Caption> {\n    const toReturn = await this.youtube.oauth.uploadCaption(this.id, language, name, track, draft)\n    return toReturn\n  }\n\n  /**\n   * Updates a caption track of a video.\n   * Must be using an access token with correct scopes.\n   * @param track The modified caption track to upload.\n   * @param draft Whether or not the track is a draft.\n   */\n  /* istanbul ignore next */\n  public async updateCaption (track: Buffer, draft: boolean = null): Promise<Caption> {\n    const toReturn = await this.youtube.oauth.updateCaption(this.id, track, draft)\n    return toReturn\n  }\n}\n"],"sourceRoot":"../../src"}